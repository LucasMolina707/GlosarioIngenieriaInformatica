<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>Flipbook - Mínimo funcional</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body{margin:0;font-family:system-ui,Segoe UI,Roboto,Arial;background:#e9e9e9}
    .wrap{max-width:980px;margin:24px auto;padding:12px}
    .controls{display:flex;gap:8px;margin:8px 0 12px}
    button{padding:8px 12px;border:1px solid #ccc;border-radius:8px;background:#fff;cursor:pointer}
    #bookBox{width:900px;height:600px;margin:0 auto;box-shadow:0 18px 40px rgba(0,0,0,.22);background:#f6f6f6;border-radius:10px;overflow:hidden}
    #flipbook{width:100%;height:100%}
    #flipbook .page{background:#fff}
    #flipbook .page img{width:100%;height:100%;object-fit:contain;display:block}
    .hint{opacity:.7;margin-top:6px}
    @media (max-width:940px){#bookBox{width:96vw;height:64vw;max-height:80vh}}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Flipbook - Mínimo funcional</h1>
    <div class="controls">
      <button id="prevBtn">⟵ Anterior</button>
      <button id="nextBtn">Siguiente ⟶</button>
      <button id="peelBtn">Mostrar esquina</button>
      <span id="status" class="hint"></span>
    </div>
    <div id="bookBox">
      <div id="flipbook"></div>
    </div>
    <p class="hint">Consejo: arrastra desde una esquina, usa las flechas del teclado o los botones.</p>
  </div>

  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/turn.js/3/turn.min.js"></script>
  <script>
    (function(){
      const nombreBase = "1759736533579-56cd1495-ffd6-46db-91f2-746084bacc2a";
      const numberOfPages = 8; // prueba con pocas páginas; luego cambia a 261
      const assetsPath = "pages/";
      const $flip = $("#flipbook");
      const $status = $("#status");

      function log(msg){ console.log(msg); $status.text(msg); }

      function build(){
        const frag = document.createDocumentFragment();
        for(let i=1;i<=numberOfPages;i++){
          const d = document.createElement("div");
          d.className = "page";
          const img = document.createElement("img");
          img.alt = "Página " + i;
          img.loading = "lazy";
          img.src = assetsPath + nombreBase + "_" + i + ".jpg";
          d.appendChild(img);
          frag.appendChild(d);
        }
        $flip[0].appendChild(frag);
      }

      function initTurn(){
        if (!$.fn.turn) {
          log("ERROR: $.fn.turn no está disponible. Revisa que turn.min.js cargó correctamente.");
          return;
        }
        const box = document.getElementById("bookBox").getBoundingClientRect();
        $flip.turn({
          display: box.width < 720 ? "single" : "double",
          width: Math.round(box.width),
          height: Math.round(box.height),
          autoCenter: true,
          duration: 1200,
          elevation: 300,
          gradients: true,
          acceleration: true,
          when: {
            turning: function(e, page){ log("Girando a página " + page); },
            turned: function(e, page){ log("Página actual: " + page); $flip.turn("center"); }
          }
        });
        // Muestra “peel” y hace un flip de demostración
        $flip.turn("peel","br");
        setTimeout(()=> $flip.turn("next"), 1000);
      }

      $(window).on("load", function(){
        build();
        initTurn();

        $("#prevBtn").on("click", ()=> $flip.turn("previous"));
        $("#nextBtn").on("click", ()=> $flip.turn("next"));
        $("#peelBtn").on("click", ()=> $flip.turn("peel","br"));

        $(document).on("keydown", (e)=>{
          if (e.key === "ArrowLeft")  $flip.turn("previous");
          if (e.key === "ArrowRight") $flip.turn("next");
        });

        // Relayout en resize
        $(window).on("resize", ()=>{
          if (!$flip.data("turn")) return;
          const box = document.getElementById("bookBox").getBoundingClientRect();
          $flip.turn("size", Math.round(box.width), Math.round(box.height));
          const mode = box.width < 720 ? "single" : "double";
          if ($flip.turn("display") !== mode) $flip.turn("display", mode);
          $flip.turn("center");
        });
      });
    })();
  </script>
</body>
</html>
